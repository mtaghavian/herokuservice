<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
    <title>capture microphone audio into buffer</title>
    <link rel="icon" type="image/png" href="favicon.png"/>

</head>
<body>
<br/>
<button type="button" onclick="startAudio()">Start</button>

<p>Volume</p>
<input id="volume" type="range" min="0" max="1" step="0.1" value="0.5"/>

<script type="text/javascript">

    var startAudio = function () {

        var audioContext = new AudioContext();
        var BUFF_SIZE = 16384;

        if (!navigator.getUserMedia)
            navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia ||
                navigator.mozGetUserMedia || navigator.msGetUserMedia;

        if (navigator.getUserMedia) {
            navigator.getUserMedia({audio: true}, function (stream) {
                    startMicrophone(stream);
                }, function (e) {
                    alert('Error capturing audio.');
                }
            );
        } else {
            alert('getUserMedia not supported in this browser.');
        }

        function process(event) {
            console.log("masoud");
            //var microphoneBuffer = event.inputBuffer.getChannelData(0);
            //show_some_data(microphone_output_buffer, 5, "from getChannelData");
        };

        var gainNode;
        var micStream;
        var scriptProcessorNode;

        function startMicrophone(stream) {
            micStream = audioContext.createMediaStreamSource(stream);
            gainNode = audioContext.createGain();
            gainNode.connect(audioContext.destination);
            //micStream.connect(gainNode);

            scriptProcessorNode = audioContext.createScriptProcessor(BUFF_SIZE, 1, 1);
            scriptProcessorNode.onaudioprocess = process;
            micStream.connect(scriptProcessorNode);

            document.getElementById('volume').addEventListener('change', function () {
                var value = this.value;
                gainNode.gain.value = value;
            });

            //scriptProcessorNode = audioContext.createScriptProcessor(BUFF_SIZE, 1, 1);
            //scriptProcessorNode.onaudioprocess = process;
            //micStream.connect(scriptProcessorNode);
        }
    };

</script>

</body>
</html>